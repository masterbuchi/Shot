<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title> Version Alpha Gegnerklasse 1.3 </title>
    <script src="js/phaser.js"></script>
    <script src="js/Message.js"></script>
    <script src="js/Waffe.js"></script>
    <script src="js/Bullets.js"></script>
    <script src="js/Gegner.js"></script>
    <script src="js/Player.js"></script>
    <script src="js/preload.js"></script>

    <style type="text/css">
        body {
            display: inline-block;
            text-align: center;
            margin: 0 auto;
            background-color: darkblue;
        }

        html {
            text-align: center;
        }
    </style>
</head>

<body>

    <script type="text/javascript">
        var game = new Phaser.Game(1024, 768, Phaser.AUTO, '', {
            preload: preload,
            create: create,
            update: update
        });

        // Coole Variable
        var SchussPassiertjetzt = 0;
        // Spielelemente
        var Plattformen;
        // Musik
        var music;

        // Menuinformationen
        var hauptnachricht;
        var ausgeruesteterWaffenText;
        var munitionsText;
        // Steuerungsvariablen
        var spaceKey;
        var wKey;
        var aKey;
        var sKey;
        var dKey;




        var child_waffe;


        var player;

        // Waffen
        var munition;

        var Waffen;

        // Schussarten
        var akSchuss;
        var shotgunSchuss;
        var pistolenSchuss;
        // Waffe aufgenommen
        var sgAufgenommen;
        var rwAufgenommen;
        var akAufgenommen;
        var pistoleAufgenommen;
        // Raketenwerfer
        var raketenexplosion;

        //Gegnergruppen
        var GegnerGruppe;

        var Leben = 0;
        var gegnerZahl = 0;
        var gegnerBesiegt = 0;
        //Animationsvariablen
        var richtung = 0;
        var aktiv = false;
        var gegneraktiv = false;
        let gegner;

        var background;
        let weltbreite = 2000;
        let welthöhe = 2000;

        function create() {
            game.physics.startSystem(Phaser.Physics.ARCADE);
            // Welt vergrößern
            game.world.setBounds(0, 0, weltbreite, welthöhe);

            // Musik
            // this.music = game.add.audio('music');
            // this.music.play();

            // Hintergrund
            background = game.add.tileSprite(0, 0, 2000, 2000, 'background');

            // Plattformen
            Plattformen = game.add.group();
            Plattformen.enableBody = true;
            ledge = Plattformen.create(400, game.world.height - 200, 'platform');
            ledge2 = Plattformen.create(150, game.world.height - 100, 'platform');
            ledge.body.immovable = true;
            ledge2.body.immovable = true;
            // Boden
            ground = Plattformen.create(0, game.world.height - 10, 'ground');
            ground.scale.setTo(2, 2);
            ground.body.immovable = true;


            // var myGroup = game.add.group();
            // myGroup.classType = MyAwesomeSprite;
            // myGroup.createMultiple(20);

            SpielerGruppe = game.add.group();

            SpielerGruppe.add(new Player(this.game));
            player = SpielerGruppe.getFirstExists(false);
            player.spawn(500, game.world.height - 325, 'keine');


            // Gruppe der Waffen
            Waffen = game.add.group();
            game.Waffen = Waffen;

            for (let j = 0; j < 10; j++) {
                Waffen.add(new Waffe(this.game));
            }

            pistole = Waffen.getFirstExists(false);
            pistole.spawn(300, game.world.height - 800, 'pistole');

            sg = Waffen.getFirstExists(false);
            sg.spawn(500, game.world.height - 800, 'shotgun');

            ak = Waffen.getFirstExists(false);
            ak.spawn(30, game.world.height - 800, 'ak');

            rw = Waffen.getFirstExists(false);
            rw.spawn(400, game.world.height - 800, 'raketenwerfer');

            // // Projektile
            // akSchuss = new Bullets(this.game, 20, 'akSchuss', 500, 60, 30, 30, 0, false);

            // pistolenSchuss = new Bullets(this.game, 12, 'pistolenSchuss', 500, 1000, 12, 40, 0, false);

            rakete = new Bullets(this.game, 5, 'rakete', 200, 200, 1, 30, 0, false);

            // shotgunSchuss = new Bullets(this.game, 5, 'shotgunSchuss', 500, 500, 5, 40, 0, false);
            // shotgunSchuss.multiFire = true;
            // shotgunSchuss.bulletAngleVariance = 5;


            // // Gruppe für Kugeln und Raketen
            // Kugeln = game.add.group();
            // Kugeln.add(akSchuss.bullets);
            // Kugeln.add(shotgunSchuss.bullets);
            // Kugeln.add(pistolenSchuss.bullets);

            // Gruppen der Gegner
            GegnerGruppe = game.add.group();


            //Gegner werden in Gruppe erzeugt
            for (let i = 0; i < 10; i++) {
                GegnerGruppe.add(new Gegner(this.game, player));
            }

            // Gegner werden gespawnt
            gegner = GegnerGruppe.getFirstExists(false);
            gegner.spawn(100, (game.world.height - 222), "starkerGegner", 'right', 'pistole');

            gegner = GegnerGruppe.getFirstExists(false);
            gegner.spawn(900, (game.world.height - 122), "starkerGegner", 'kneel_left', 'raketenwerfer');

            gegner = GegnerGruppe.getFirstExists(false);
            gegner.spawn(350, (game.world.height - 500), "schwacherGegner", 'left', 'shotgun');

            gegner = GegnerGruppe.getFirstExists(false);
            gegner.spawn(600, (game.world.height - 122), "schwacherGegner", 'kneel_left', 'ak');


            // Munitions Text
            hauptnachricht = game.add.text((game.height / 2), (game.width / 2) - 200, '', {
                fontSize: '32px',
                fill: '#000'
            });
            hauptnachricht.fixedToCamera = true;


            // Munitions Text
            munitionsText = game.add.text(16, 112, '', {
                fontSize: '32px',
                fill: '#000'
            });
            munitionsText.fixedToCamera = true;

            // Waffe ausgerüstet
            ausgeruesteterWaffenText = game.add.text(16, 64, '', {
                fontSize: '32px',
                fill: '#000'
            });
            ausgeruesteterWaffenText.fixedToCamera = true;


            // Kamera
            game.camera.follow(player);
        }

        function update() {

            // game.debug.spriteInfo(player, game.width - 400, game.height - 500);
            // game.debug.spriteBounds(player);


            // //  Gegner mit Schuss oder Rakete treffen
            // game.physics.arcade.overlap(Kugeln, GegnerGruppe, GegnerTreffen, null, this);

            // Wenn der Spieler einen Gegner berührt erscheint der GameOver Screen.
            game.physics.arcade.overlap(GegnerGruppe, player, gameOver, null, this);

            // Kolissionverwaltung von Waffen, Gegnern, Plattformen & Projektile
            game.physics.arcade.collide(Waffen, Waffen);
            game.physics.arcade.collide(Waffen, GegnerGruppe);
            game.physics.arcade.collide(Waffen, Plattformen);
            game.physics.arcade.collide(GegnerGruppe, Plattformen);
            game.physics.arcade.collide(player, Plattformen);

            // // Waffen aufnehmen
            // game.physics.arcade.overlap(player, Waffen, nimmwaffe, null, this);

            // // Projektile treffen Plattformen
            // game.physics.arcade.overlap(Kugeln, Plattformen, killSimpleProjectiles, null, this);

            if (raketenexplosion == null) {
                // Projektilwaffen, die ein Projektil abschiessen dass anschließend explodiert
                game.physics.arcade.overlap(rakete.bullets, Plattformen, raketeExplodiert, null, this);
                //Kollision Rakete mit Gegner
                game.physics.arcade.overlap(rakete.bullets, GegnerGruppe, raketeExplodiert, null, this);
            }
            // RaketenExplosion anhalten oder stoppen
            if (raketenexplosion != null) {
                if (game.physics.arcade.isPaused == true) {
                    explosionTween.pause();
                    raketenexplosion.animations.paused = true;

                } else {
                    explosionTween.resume();
                    if (raketenexplosion.animations.paused != false) {
                        raketenexplosion.animations.paused = false;
                    }
                }
                explosionTween.onComplete.addOnce(function () {
                    raketenexplosion.kill();
                }, this);
            }
            //Kollision Raketenexplosion mit Gegner

            //// KOLLISION MIT GEGNER IST DEAKTIVIERT
            // game.physics.arcade.overlap(raketenexplosion, GegnerGruppe, GegnerTreffen,
            //     null,
            //     this);
            //Kollision Raketenexplosion mit Player
            

            

            // Wenn alle Gegner getöt wurden
            if (GegnerGruppe.total == 0) {
                hauptnachricht.text = 'Gewonnen';
                console.log(GegnerGruppe.total)
            }


        }
        // Funktionen


       
        // // Gegner wird von Kugel getroffen
        // function GegnerTreffen(schuss, gegner) {
        //     gegner.hit(schuss);
        //     schuss.kill();

        // }


        // function killSimpleProjectiles(schuss, Plattformen) {
        //     schuss.kill();
        // }

        // Rakete erzeugt Raketenexplosion
        function raketeExplodiert(rakete, Plattformen) {
            raketenexplosion = game.add.sprite(rakete.x, rakete.y, 'explosion');
            raketenexplosion.animations.add('boom', [0, 1, 2, 3, 4, 5, 6, 7, 8], 10, false);
            raketenexplosion.animations.play('boom');
            raketenexplosion.anchor.setTo(0.5, 0.5);
            raketenexplosion.scale.setTo(0.1);
            game.physics.arcade.enable(raketenexplosion);
            raketenexplosion.enableBody = true;
            rakete.kill();

            explosionTween = game.add.tween(raketenexplosion.scale);
            explosionTween.to({
                x: 0.8,
                y: 0.8
            }, 1000, Phaser.Easing.Linear.None, true);


        }

        // Game Over Funktion
        function gameOver(player) {
            player.kill();
            hauptnachricht.text = 'Game Over';

        }
    </script>

</body>

</html>